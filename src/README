# ADC Toolbox Python

Python port of MATLAB ADC analysis tools.

Last Updated: 2025-11-21

## Testing Status

### Fully Tested (MATLAB Golden Reference Validated)

These tools have been tested against MATLAB golden reference images with 13 test cases:
- Sine_wave_10_70_bit_nonlinearity
- Sine_wave_13_69_bit
- gain_error_0P95, 0P99, 1P01, 1P05
- clip_0P06, 0P07
- jitter_0P001, 0P002, 0P0002
- kickback_0P07, 0P007

| File | Description | Status |
|------|-------------|--------|
| `spec_plot.py` | Spectrum analysis (ENoB, SNDR, SFDR, THD) | ✅ Verified |
| `specPlotPhase.py` | Polar spectrum with phase alignment | ✅ Verified (fixed 2025-11-21) |
| `tomDecomp.py` | Thompson decomposition (dependent/independent error) | ✅ Verified (fixed 2025-11-21) |
| `errHistSine.py` | Error histogram by code/phase | ✅ Verified |
| `sineFit.py` | Sine wave fitting | ✅ Verified |
| `findBin.py` | Find frequency bin | ✅ Verified |
| `findFin.py` | Find input frequency | ✅ Verified |
| `alias.py` | Frequency aliasing calculation | ✅ Verified |

### Has Test Files (Partial Testing)

| File | Description | Status |
|------|-------------|--------|
| `FGCalSine.py` | Foreground calibration using sinewave | ⚠️ Has tests, needs MATLAB comparison |
| `INLSine.py` | INL analysis using sinewave | ⚠️ Has tests, needs MATLAB comparison |

### Unverified (Need Testing)

| File | Description | Status |
|------|-------------|--------|
| `NTFAnalyzer.py` | Noise transfer function analysis | ❌ Not tested |
| `bitInBand.py` | Frequency band filter | ❌ Explicitly marked unverified |
| `specPlot2Tone.py` | Two-tone spectrum analysis | ❌ Not tested |
| `FGCalSine_2freq.py` | Two-frequency calibration | ❌ Not tested |
| `FGCalSineOS.py` | Oversampling calibration | ❌ Not tested |
| `overflowChk.py` | Overflow check | ❌ Not tested |
| `findVinpp.py` | Find input Vpp | ❌ Not tested |
| `cap2weight.py` | Capacitor to weight conversion | ❌ Not tested |

### Standalone Tools (No MATLAB Reference)

| File | Description | Status |
|------|-------------|--------|
| `jitter.py` | SAR ADC jitter simulation | ✅ Standalone tool |
| `detect_jitter.py` | Jitter detection from data | ✅ Standalone tool |
| `phase_polar_plot.py` | Phase-domain error polar plot | ✅ Standalone tool |
| `cdac_redundancy_analysis.py` | CDAC redundancy analysis | ✅ Standalone tool |
| `code_overflow_analysis.py` | Code overflow analysis | ✅ Standalone tool |
| `multimodal_report.py` | Multimodal report generation | ✅ Standalone tool |

## Running Tests

### Run all tests against MATLAB reference:
```bash
python tests/run_all_tests.py
```

Output will be saved to `tests/output/<case_name>/` with:
- Python-generated plots
- MATLAB reference plots (for comparison)

### Test data location:
- CSV files: `../matlab_reference/reference_data/`
- Golden images: `../matlab_reference/output/`

## Fixes Applied (2025-11-21)

1. **tomDecomp.py line 106**: Fixed sign of dependent error
   - Before: `dep = signal_all - signal` (wrong)
   - After: `dep = signal - signal_all` (correct)

2. **specPlotPhase.py lines 82-85**: Fixed early break in harmonic phase alignment
   - Removed `if j >= n_fft: break` to process all harmonics with aliasing

## Directory Structure

```
ADC_Toolbox_Python/
├── Core Analysis Tools (✅ Tested)
│   ├── spec_plot.py
│   ├── specPlotPhase.py
│   ├── tomDecomp.py
│   ├── errHistSine.py
│   ├── sineFit.py
│   ├── findBin.py
│   ├── findFin.py
│   └── alias.py
│
├── Calibration Tools (⚠️ Partial)
│   ├── FGCalSine.py
│   ├── FGCalSine_2freq.py
│   ├── FGCalSineOS.py
│   └── INLSine.py
│
├── Standalone Tools
│   ├── jitter.py
│   ├── detect_jitter.py
│   ├── phase_polar_plot.py
│   ├── cdac_redundancy_analysis.py
│   ├── code_overflow_analysis.py
│   └── multimodal_report.py
│
├── Utilities (❌ Need Testing)
│   ├── NTFAnalyzer.py
│   ├── bitInBand.py
│   ├── specPlot2Tone.py
│   ├── overflowChk.py
│   ├── findVinpp.py
│   └── cap2weight.py
│
└── tests/
    ├── run_all_tests.py      # Main test runner
    ├── test_*.py             # Individual test files
    └── output/               # Test output (generated)
```

## Notes

- Precision: MATLAB and Python results may differ after 3 decimal places due to floating-point differences
- All tools assume normalized frequency (Fin/Fs) unless otherwise specified

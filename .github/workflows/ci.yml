name: CI

on:
  pull_request:
    branches: [ main ]
    paths-ignore:
      - 'python/docs/**'
      - '**.md'
      - '**.rst'
      - '.github/workflows/docs.yml'
  push:
    branches: [ main ]
    paths-ignore:
      - 'python/docs/**'
      - '**.md'
      - '**.rst'
      - '.github/workflows/docs.yml'

jobs:
  test-examples:
    name: Test Examples
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: |
          pip install numpy matplotlib scipy
          pip install -e ./python

      - name: Run Basic Examples (01_basic)
        run: |
          cd python/src/adctoolbox/examples/01_basic

          EXAMPLES="
            exp_b01_environment_check.py
            exp_b02_coherent_vs_non_coherent.py
          "

          for script in $EXAMPLES; do
            echo "Running $script..."
            python "$script" || exit 1
          done
        env:
          MPLBACKEND: Agg

      - name: Run Spectrum Examples (02_spectrum)
        run: |
          cd python/src/adctoolbox/examples/02_spectrum

          EXAMPLES="
            exp_s01_analyze_spectrum_simplest.py
            exp_s03_analyze_spectrum_savefig.py
            exp_s06_sweeping_fft_and_osr.py
            exp_s07_spectrum_averaging.py
            exp_s08_windowing_deep_dive.py
          "

          for script in $EXAMPLES; do
            echo "Running $script..."
            python "$script" || exit 1
          done
        env:
          MPLBACKEND: Agg

      - name: Run Signal Generation Examples (03_generate_signals)
        run: |
          cd python/src/adctoolbox/examples/03_generate_signals

          EXAMPLES="
            exp_g01_generate_signal_demo.py
            exp_g03_sweep_quant_bits.py
            exp_g04_sweep_jitter_fin.py
            exp_g05_sweep_static_nonlin.py
            exp_g06_sweep_dynamic_nonlin.py
            exp_g07_sweep_interferences.py
          "

          for script in $EXAMPLES; do
            echo "Running $script..."
            python "$script" || exit 1
          done
        env:
          MPLBACKEND: Agg

      # - name: Run Analog Debug Examples (04_debug_analog)
      #   run: |
      #     cd python/src/adctoolbox/examples/04_debug_analog

      #     EXAMPLES="
      #       exp_a01_fit_sine_4param.py
      #       exp_a02_analyze_error_by_value.py
      #       exp_a03_analyze_error_by_phase.py
      #       exp_a04_jitter_calculation.py
      #       exp_a11_decompose_harmonics.py
      #       exp_a12_decompose_harmonics_polar.py
      #       exp_a21_analyze_error_pdf.py
      #       exp_a22_analyze_error_spectrum.py
      #       exp_a23_analyze_error_autocorrelation.py
      #       exp_a24_analyze_error_envelope_spectrum.py
      #       exp_a25_spectra.py
      #       exp_a31_fit_static_nonlin.py
      #       exp_a32_inl_from_sine_sweep_length.py
      #       exp_a41_analyze_phase_plane.py
      #       exp_a42_analyze_error_phase_plane.py
      #     "

      #     for script in $EXAMPLES; do
      #       echo "Running $script..."
      #       python "$script" || exit 1
      #     done
      #   env:
      #     MPLBACKEND: Agg

      # - name: Run Digital Debug Examples (05_debug_digital)
      #   run: |
      #     cd python/src/adctoolbox/examples/05_debug_digital

      #     EXAMPLES="
      #       exp_d01_cal_weight_sine_lite.py
      #       exp_d02_cal_weight_sine.py
      #       exp_d03_redundancy_comparison.py
      #       exp_d11_bit_activity.py
      #       exp_d12_sweep_bit_enob.py
      #       exp_d13_weight_scaling.py
      #       exp_d14_overflow_check.py
      #     "

      #     for script in $EXAMPLES; do
      #       echo "Running $script..."
      #       python "$script" || exit 1
      #     done
      #   env:
      #     MPLBACKEND: Agg

      - name: Run Toolset Examples (06_use_toolsets)
        run: |
          cd python/src/adctoolbox/examples/06_use_toolsets

          EXAMPLES="
            exp_t01_aout_dashboard_single.py
            exp_t03_dout_dashboard_single.py
          "

          for script in $EXAMPLES; do
            echo "Running $script..."
            python "$script" || exit 1
          done
        env:
          MPLBACKEND: Agg

      # - name: Run Metric Calculation Examples (07_calculate_metric)
      #   run: |
      #     cd python/src/adctoolbox/examples/07_calculate_metric

      #     EXAMPLES="
      #       exp_b01_aliasing_nyquist_zones.py
      #       exp_b02_unit_conversions.py
      #       exp_b03_calculate_fom.py
      #       exp_b05_amplitudes_to_snr.py
      #       exp_b06_convert_nsd_snr.py
      #     "

      #     for script in $EXAMPLES; do
      #       echo "Running $script..."
      #       python "$script" || exit 1
      #     done
        # env:
        #   MPLBACKEND: Agg

name: CI - Smoke Tests

on:
  pull_request:
    branches: [ main ]
  push:
    branches: [ main ]

jobs:
  # MATLAB tests disabled - GitHub Actions doesn't support MATLAB without license
  # matlab-tests:
  #   name: MATLAB Smoke Tests
  #   runs-on: ubuntu-latest
  #
  #   steps:
  #     - name: Checkout code
  #       uses: actions/checkout@v4
  #
  #     - name: Set up MATLAB
  #       uses: matlab-actions/setup-matlab@v2
  #       with:
  #         release: R2024b
  #
  #     - name: Run MATLAB smoke tests
  #       uses: matlab-actions/run-command@v2
  #       with:
  #         command: |
  #           fprintf('=== MATLAB Smoke Tests ===\n\n');
  #
  #           % Add source to path
  #           addpath(genpath('matlab/src'));
  #
  #           % Test 1: alias (no dataset needed)
  #           fprintf('[1/3] Testing alias...\n');
  #           cd matlab/tests/unit;
  #           try
  #             test_alias;
  #             fprintf('✓ alias test passed\n\n');
  #           catch ME
  #             fprintf('✗ alias test failed: %s\n', ME.message);
  #             cd ../..;
  #             exit(1);
  #           end
  #           cd ../..;
  #
  #           % Test 2: Generate small dataset and test sineFit
  #           fprintf('[2/3] Testing sineFit...\n');
  #           try
  #             % Generate minimal sine wave data
  #             N = 1024;
  #             Fin_bin = 101;  % Frequency in bins
  #             t = (0:N-1)';
  #             aout = sin(2*pi*Fin_bin/N*t) + 0.01*randn(N,1);
  #
  #             % Test sineFit (returns normalized frequency 0-1)
  #             [data_fit, freq_normalized, mag, dc, phi] = sineFit(aout);
  #             Fin_bin_estimated = freq_normalized * N;
  #             error_bins = abs(Fin_bin_estimated - Fin_bin);
  #             assert(error_bins < 1, sprintf('Frequency estimation failed: expected %d bins, got %.2f bins', Fin_bin, Fin_bin_estimated));
  #             fprintf('✓ sineFit test passed (freq: %.4f → %.1f bins)\n\n', freq_normalized, Fin_bin_estimated);
  #           catch ME
  #             fprintf('✗ sineFit test failed: %s\n', ME.message);
  #             exit(1);
  #           end
  #
  #           % Test 3: specPlot
  #           fprintf('[3/3] Testing specPlot...\n');
  #           try
  #             [ENoB, SNDR, SNR, SFDR, HD2, HD3] = specPlot(aout, 'Fin', Fin, 'Fs', N, 'verbose', false);
  #             assert(ENoB > 0 && ENoB < 20, 'Invalid ENoB');
  #             fprintf('✓ specPlot test passed (ENoB: %.2f bits)\n\n', ENoB);
  #           catch ME
  #             fprintf('✗ specPlot test failed: %s\n', ME.message);
  #             exit(1);
  #           end
  #
  #           fprintf('=== All MATLAB smoke tests passed ===\n');

  python-tests:
    name: Python Smoke Tests
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Run Python test
        run: |
          python -c "print('Hello World')"

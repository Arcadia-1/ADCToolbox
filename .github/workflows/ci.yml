name: CI - Smoke Tests

on:
  pull_request:
    branches: [ main ]
  push:
    branches: [ main ]

jobs:
  matlab-smoke-tests:
    name: MATLAB Quick Validation
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up MATLAB
        uses: matlab-actions/setup-matlab@v2
        with:
          release: R2024b

      - name: Run quick MATLAB smoke tests
        uses: matlab-actions/run-command@v2
        with:
          command: |
            addpath(genpath('matlab/src'));
            cd matlab/tests/unit;
            try
              test_alias;
              fprintf('\n✓ test_alias passed\n');
              test_sineFit;
              fprintf('\n✓ test_sineFit passed\n');
              test_specPlot;
              fprintf('\n✓ test_specPlot passed\n');
              fprintf('\n=== Quick validation complete ===\n');
            catch ME
              fprintf('\n✗ Test failed: %s\n', ME.message);
              exit(1);
            end

  python-syntax-check:
    name: Python Syntax Validation
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: |
          pip install numpy pandas matplotlib scipy

      - name: Check Python imports
        run: |
          python -c "import sys; sys.path.insert(0, 'python'); from adctoolbox.common import alias; print('✓ Imports successful')"

      - name: Run Python syntax check
        run: |
          python -m py_compile python/adctoolbox/**/*.py || true
          echo "✓ Python syntax check complete"

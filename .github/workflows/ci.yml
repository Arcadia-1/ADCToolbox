name: CI - Smoke Tests

on:
  pull_request:
    branches: [ main ]
  push:
    branches: [ main ]

jobs:
  python-tests:
    name: Python Smoke Tests
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: |
          pip install numpy pandas matplotlib scipy

      - name: Run Python test
        run: |
          export PYTHONPATH="${GITHUB_WORKSPACE}/python/src:${PYTHONPATH}"
          python -c "
          import numpy as np
          from adctoolbox.common import alias
          print('Hello World')

          # Test alias function
          result = alias(600, 1024)
          expected = 424
          print(f'Testing alias function: alias(600, 1024) = {result}')
          assert abs(result - expected) < 0.01, f'Expected {expected}, got {result}'
          print(f'âœ“ alias test passed!')

          # Create a sinewave
          N = 1024
          Fin_bin = 101
          t = np.arange(N)
          sinewave = np.sin(2 * np.pi * Fin_bin / N * t)

          print(f'Created sinewave with {len(sinewave)} samples')
          print(f'Min: {sinewave.min():.3f}, Max: {sinewave.max():.3f}')

          # Save to file
          np.savetxt('sinewave.txt', sinewave)
          print('Sinewave saved to sinewave.txt')
          "
